<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë„ì„œ ëŒ€ì—¬ ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='library.css') }}">
</head>
<body>
    <div class="container">
        <header class="library-header">
            <h1>ğŸ“š ë„ì„œ ëŒ€ì—¬ ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
            <a href="/add" class="btn-add">+ ì±… ì¶”ê°€</a>
        </header>

        <div class="stats-bar">
            <div class="stat-card available">
                <div class="stat-number">{{ available_count }}</div>
                <div class="stat-label">ëŒ€ì—¬ ê°€ëŠ¥</div>
            </div>
            <div class="stat-card borrowed">
                <div class="stat-number">{{ borrowed_count }}</div>
                <div class="stat-label">ëŒ€ì—¬ ì¤‘</div>
            </div>
            <div class="stat-card total">
                <div class="stat-number">{{ available_count + borrowed_count }}</div>
                <div class="stat-label">ì „ì²´ ë„ì„œ</div>
            </div>
        </div>

        <div class="filter-bar">
            <form action="/" method="get" class="filter-form">
                <div class="filter-buttons">
                    <a href="/?status=all" class="filter-btn {% if status_filter == 'all' %}active{% endif %}">ì „ì²´</a>
                    <a href="/?status=available" class="filter-btn {% if status_filter == 'available' %}active{% endif %}">ëŒ€ì—¬ ê°€ëŠ¥</a>
                    <a href="/?status=borrowed" class="filter-btn {% if status_filter == 'borrowed' %}active{% endif %}">ëŒ€ì—¬ ì¤‘</a>
                </div>
                <div class="search-box">
                    <input type="text" name="search" placeholder="ì±… ì œëª© ë˜ëŠ” ì €ì ê²€ìƒ‰" value="{{ search }}" class="search-input">
                    <button type="submit" class="btn-search">ê²€ìƒ‰</button>
                </div>
            </form>
        </div>

        <div class="books-grid">
            {% for book in books %}
            <div class="book-card {% if book.status == 'borrowed' %}borrowed{% endif %}">
                <div class="book-image">
                    <img src="{{ book.image_url }}" alt="{{ book.title }}" onerror="this.src='https://via.placeholder.com/200x280?text=No+Image'">
                    <div class="status-badge {% if book.status == 'available' %}available{% else %}borrowed{% endif %}">
                        {% if book.status == 'available' %}
                        âœ“ ëŒ€ì—¬ ê°€ëŠ¥
                        {% else %}
                        âœ— ëŒ€ì—¬ ì¤‘
                        {% endif %}
                    </div>
                </div>
                <div class="book-info">
                    <h3 class="book-title">{{ book.title }}</h3>
                    <p class="book-author">{{ book.author }}</p>
                    
                    {% if book.status == 'borrowed' %}
                    <div class="borrow-info">
                        <div class="info-row">
                            <span class="info-label">ëŒ€ì—¬ì:</span>
                            <span class="info-value">{{ book.borrower }}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">ëŒ€ì—¬ì¼:</span>
                            <span class="info-value">{{ book.borrow_date }}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">ë°˜ë‚© ì˜ˆì •ì¼:</span>
                            <span class="info-value return-date">{{ book.return_date }}</span>
                        </div>
                    </div>
                    {% endif %}
                    
                    <div class="book-actions">
                        {% if book.status == 'available' %}
                        <button onclick="showBorrowModal({{ book.id }}, '{{ book.title }}')" class="btn-borrow">ëŒ€ì—¬í•˜ê¸°</button>
                        {% else %}
                        <form action="/return/{{ book.id }}" method="post" style="display: inline;">
                            <button type="submit" class="btn-return">ë°˜ë‚©í•˜ê¸°</button>
                        </form>
                        {% endif %}
                        <a href="/edit/{{ book.id }}" class="btn-edit">ìˆ˜ì •</a>
                        <form action="/delete/{{ book.id }}" method="post" style="display: inline;" onsubmit="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
                            <button type="submit" class="btn-delete">ì‚­ì œ</button>
                        </form>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        {% if books|length == 0 %}
        <div class="empty-state">
            <p>ğŸ“– ë“±ë¡ëœ ì±…ì´ ì—†ìŠµë‹ˆë‹¤.</p>
            <a href="/add" class="btn-add">ì²« ë²ˆì§¸ ì±… ì¶”ê°€í•˜ê¸°</a>
        </div>
        {% endif %}
    </div>

    <!-- ëŒ€ì—¬ ëª¨ë‹¬ -->
    <div id="borrowModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeBorrowModal()">&times;</span>
            <h2>ì±… ëŒ€ì—¬í•˜ê¸°</h2>
            <p id="modalBookTitle" class="modal-book-title"></p>
            <form id="borrowForm" method="post">
                <div class="form-group">
                    <label for="borrower">ëŒ€ì—¬ì ì´ë¦„</label>
                    <input type="text" id="borrower" name="borrower" required placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
                </div>
                <div class="modal-actions">
                    <button type="submit" class="btn-submit">ëŒ€ì—¬í•˜ê¸°</button>
                    <button type="button" onclick="closeBorrowModal()" class="btn-cancel">ì·¨ì†Œ</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        function showBorrowModal(bookId, bookTitle) {
            document.getElementById('borrowModal').style.display = 'block';
            document.getElementById('modalBookTitle').textContent = bookTitle;
            document.getElementById('borrowForm').action = '/borrow/' + bookId;
        }

        function closeBorrowModal() {
            document.getElementById('borrowModal').style.display = 'none';
        }

        window.onclick = function(event) {
            const modal = document.getElementById('borrowModal');
            if (event.target == modal) {
                closeBorrowModal();
            }
        }
    </script>
</body>
</html>
